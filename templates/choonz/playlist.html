{% extends 'choonz/base.html' %}
{% load staticfiles %}
{% load choonz_template_tags %}

{% block title_block %}
	{% if playlist %}
		{{ playlist.name }}
	{% else %}
		Unknown Playlist
	{% endif %}
{% endblock %}

{% block body_block %}
	{% if playlist %}
		<div class="jumbotron p-4">
			<div class="container">
				<div class="row">
					<div class="col">	
						<h1 class="jumbotron-heading">{{ playlist.name }}</h1>
					</div>
					<div class="col">
						<h4 class="jumbotron-heading">Average Rating: 
						{% if playlist.get_average_rating %}
							{{ playlist.get_average_rating|floatformat}}
						{% else %}
							0.0
						{% endif %}
						/5.0</h4>
					</div>
				</div>
				<div class="row">
					<div class="col m-0">
						created by <a href="{% url 'choonz:profile' playlist.creator %}">{{ playlist.creator }}</a><br />
						<strong>Description: </strong>{{ playlist.description }}<br />
						Created on: {{ playlist.createdDate }}<br />
						Last updated: {{ playlist.lastUpdatedDate }}
						
					</div>
					<div class="col m-1">
						{% if user.is_authenticated %}
							{% if user != playlist.creator %}
								{% if user_has_rated %}
									<div>
										<form class="form-inline" id="user-form" method="post" action="{% url 'choonz:rate_playlist' playlist.slug %}">
											{% csrf_token %}
											<input id="rating" name="rating" type="hidden" value="{{ rating.id }}">
											<button class="btn btn-warning" type="submit" name="submit">Edit My Rating</button>
										</form>
									</div>
								{% else %}
									<div>
										<a class="btn btn-warning" href="{% url 'choonz:rate_playlist' playlist.slug %}">Rate this Playlist!</a>
									</div>
								{% endif %}
							{% else %}
								{% if playlist.public %}
									<div>
										<form class="form-inline" id="user-form" method="get" action="{% url 'choonz:publish_playlist' %}">
											{% csrf_token %}
											<input id="playlist_id" name="playlist_id" type="hidden" value="{{ playlist.id }}">
											<button class="btn btn-warning" type="submit" data-playlist_id="{{ playlist.id }}" name="submit">Send to Drafts</button>
										</form>
									</div>
								{% else %}
									<div class="row">
										<div class="col p-0">
											<form class="form-inline" id="user-form" method="post" action="{% url 'choonz:publish_playlist' %}">
												{% csrf_token %}
												<input id="playlist_id" name="playlist_id" type="hidden" value="{{ playlist.id }}">
												<button class="btn btn-warning" type="submit" data-playlist_id="{{ playlist.id }}" name="submit">Publish this Playlist!</button>
											</form>
										</div>
										<div class="col p-0">
											<a class="btn btn-info" href="{% url 'choonz:edit_playlist' playlist.slug %}">Edit Playlist</a>
										</div>
									</div>
								{% endif %}
							{% endif %}
						{% endif %}
					</div>
				</div>
			</div>
		</div>
		
		<h3 class="card">Tags:</h3>
		<div class="card m-4" id="tag-listing">
            {% block sidebar_block %}
                {% get_tag_list playlist %}
            {% endblock %}
        </div> 
		
		<h3 class="card">Track List</h3>
		{% if songs %}
		<div id="songs-listing">
			<ul>
				{% for song in songs %}
				<li class="choonz-row">
					<div class="col-md-9">
						<div class="centred-left-indent-5 row">
							<h5>{{ song.title }}</h5>
						</div>
						<div class="centred-left-indent-10 row">
						<span>by {% if song.artist.webpage %}
							<a href="{{ song.artist.webpage }}">{{ song.artist }}</a>
							{% else %}
								{{ song.artist }}
							{% endif %}
						</span>
						</div>
					</div>
					<div class="col-md-3">
						<div class="choonz-col">
						{% if song.linkToSpotify %}
							<a class="btn btn-primary" href="{{ song.linkToSpotify }}" target="_blank" name="submit">Listen with Spotify</a>
						{% else %}
							{% if user == playlist.creator %}
								<button class="btn btn-secondary" name="submit">Add Link to Spotify</button>
							{% endif %}
						{% endif %}
					</div>
					</div>
				</li>
				{% endfor %}
			</ul>
		</div>

		<h3 class="card">Ratings for {{ playlist.name }}</h3>
		<div class="container">
			{% if ratings %}
			<div id="rating-listing">
				<ul>
					{% for rating in ratings %}
					<li class="list-group-item">{{ rating.stars }} &#x2606; - "{{ rating.comment }}" ~ 
						<a href="{% url 'choonz:profile' rating.user.username %}">{{ rating.user.username }}</a>
					</li>
					{% endfor %}
				</ul>
			</div>
			{% else %}
					<div class="card">
						<strong>No ratings for current playlist.</strong>
					</div>
			{% endif %}
		</div>
		{% else %}
		<div class="container">
			{% if user.is_authenticated %}
				{% if user != playlist.creator %}
					<div class="card">
						<strong>No songs currently in playlist.</strong>
					</div>
				{% else %}
					<div class="card">
						<p><strong>Your playlist is looking a little bare! People can't rate it when it's empty!</strong></p>
						<ul>
							<li>Why not <a href="{% url 'choonz:edit_playlist' playlist.slug %}">add some songs</a>?</li>
							<li>Or you could <a href="{% url 'choonz:import_playlist' playlist.slug %}">import a playlist from Spotify</a>?</li>
						</ul>
					</div>
				{% endif %}
			{% else %}
				<div class="card">
					<strong>No songs currently in playlist.</strong>
				</div>
			{% endif %}
		</div>
		{% endif %}

	{% else %}
		The specified playlist does not exist.
	{% endif %}
{% endblock %}